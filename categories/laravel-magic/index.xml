<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Laravel Magic on å¿—å®‡æ—¥å¸¸</title><link>https://www.chihyu.me/categories/laravel-magic/</link><description>Recent content in Laravel Magic on å¿—å®‡æ—¥å¸¸</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Fri, 23 Dec 2022 00:00:00 +0800</lastBuildDate><atom:link href="https://www.chihyu.me/categories/laravel-magic/index.xml" rel="self" type="application/rss+xml"/><item><title>Laravel ä½¿ç”¨ axios åŒ¯å‡º Excel</title><link>https://www.chihyu.me/2022/12/laravel-magic-use-axios-export-excel/</link><pubDate>Fri, 23 Dec 2022 00:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/12/laravel-magic-use-axios-export-excel/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner.png" alt="Featured image of post Laravel ä½¿ç”¨ axios åŒ¯å‡º Excel" />&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>èªªåˆ° Laravel åŒ¯å‡º excel ç›¸ä¿¡å¤§å®¶è‚¯å®šå°é€™å¥—ä»¶ä¸é™Œç”Ÿ&lt;br>
&lt;a class="link" href="https://docs.laravel-excel.com/3.1/getting-started/" target="_blank" rel="noopener"
>å¥—ä»¶é€£çµ&lt;/a>&lt;/p>
&lt;p>ä¸éæ–‡ä»¶å…§æ²’æœ‰æåˆ°å¦‚ä½•é€é api çš„æ–¹å¼ä¸‹è¼‰æª”æ¡ˆï¼Œ&lt;br>
æˆ‘è‡ªå·±ä¹Ÿæ‘¸ç´¢å¥½ä¹…ï¼Œçµ‚æ–¼æ‰¾åˆ°æ–¹æ³•äº†&lt;br>
æƒ³èªªä¾†è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹&lt;/p>
&lt;h2 id="ä¸»è¦">ä¸»è¦&lt;/h2>
&lt;h3 id="ç’°å¢ƒä»‹ç´¹">ç’°å¢ƒä»‹ç´¹&lt;/h3>
&lt;ul>
&lt;li>&lt;code>maatwebsite/excel&lt;/code> ç‰ˆæœ¬ &lt;code>3.1&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="å‰ç«¯">å‰ç«¯&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æª”æ¡ˆåç¨±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">let&lt;/span> &lt;span class="nx">fileName&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;xxx.xlsx&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// api è·¯å¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">let&lt;/span> &lt;span class="nx">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è³‡æ–™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">let&lt;/span> &lt;span class="nx">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">axios&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">responseType&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;arraybuffer&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">headers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Content-Type&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;application/json&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}).&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">response&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">URL&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createObjectURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nx">Blob&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="nx">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// xlsx
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// xls
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// type: &amp;#39;application/vnd.ms-excel&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">link&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">link&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">url&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">link&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">setAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;download&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fileName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">body&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">appendChild&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">link&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">link&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">click&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æª”æ¡ˆé¡åˆ¥å¯ä»¥åƒè€ƒï¼š &lt;a class="link" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types" target="_blank" rel="noopener"
>MIME Types&lt;/a>&lt;/p>
&lt;h3 id="api-çš„-controller">API çš„ controller&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Illuminate\Http\Request&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">App\Exports\OrderExport&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Maatwebsite\Excel\Facades\Excel&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">OrderExportController&lt;/span> &lt;span class="k">extends&lt;/span> &lt;span class="nx">Controller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sd">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> * åŒ¯å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="k">function&lt;/span> &lt;span class="nf">export&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Request&lt;/span> &lt;span class="nv">$request&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nx">Excel&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">download&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="nx">OrderExport&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$orders&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;è¨‚å–®.xlsx&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€™é‚Šå°±ä¸ç‰¹åˆ¥è§£é‡‹ &lt;code>Excel::download&lt;/code> çš„ä½¿ç”¨æ–¹æ³•äº†&lt;br>
ä¹‹å¾Œå†è·Ÿå¤§å®¶åˆ†äº«&lt;/p></description></item><item><title>Laravel Eloquent Or Query Builder</title><link>https://www.chihyu.me/2022/09/laravel-magic-eloquent-or-query-builder/</link><pubDate>Wed, 21 Sep 2022 00:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/09/laravel-magic-eloquent-or-query-builder/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner-eloquent-or-query-builder.png" alt="Featured image of post Laravel Eloquent Or Query Builder" />&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;h3 id="ä½¿ç”¨çš„ç‰ˆæœ¬">ä½¿ç”¨çš„ç‰ˆæœ¬&lt;/h3>
&lt;p>Laravel: 7&lt;br>
php: 7.3&lt;/p>
&lt;p>æˆ‘å€‘éƒ½çŸ¥é“åœ¨ Laravel è£¡é¢å–å¾—è³‡æ–™åº«è³‡æ–™å¯ä»¥ä½¿ç”¨ &lt;code>Eloquent ORM&lt;/code> ã€&lt;code>Query Builder&lt;/code>ï¼Œ&lt;br>
ä»Šå¤©å°±ä¾†èŠèŠå…©è€…åˆ°åº•å·®åœ¨å“ªè£¡å·´ ~&lt;/p>
&lt;h2 id="ä¸»è¦å…§å®¹">ä¸»è¦å…§å®¹&lt;/h2>
&lt;h3 id="eloquent-orm">Eloquent ORM&lt;/h3>
&lt;p>é€éç‰©ä»¶çš„æ–¹å¼èª¿ç”¨è³‡æ–™ï¼Œ&lt;br>
å¯åƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/7.x/eloquent" target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>ï¼Œç›¸é—œèªæ³•å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">App\Models\User&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">User&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">where&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;Jason&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">first&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="query-builder">Query Builder&lt;/h3>
&lt;p>ç›´æ¥å°è³‡æ–™è¡¨é€²è¡Œèª¿ç”¨ï¼Œ&lt;br>
å¯å…ˆåƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/7.x/queries" target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>ï¼Œç›¸é—œèªæ³•å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Illuminate\Support\Facades\DB&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">DB&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">table&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;users&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">where&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;Jason&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">first&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ä»¥ä¸Šå…©æ®µç¨‹å¼ç¢¼ï¼Œéƒ½æ˜¯åœ¨å– name = Jason çš„äººï¼Œå–å‡ºä¾†çš„å€¼ä¹Ÿèƒ½ç›´æ¥ä½¿ç”¨&lt;/p>
&lt;/blockquote>
&lt;h3 id="é€Ÿåº¦æ¯”è¼ƒ">é€Ÿåº¦æ¯”è¼ƒ&lt;/h3>
&lt;p>å› ç‚ºæˆ‘é€™æ®µSQLæ¯”è¼ƒç°¡å–®ï¼Œæ‰€ä»¥å¾ˆé›£çœ‹å‡ºé€Ÿåº¦å“ªå€‹æ¯”è¼ƒå¿«&lt;br>
æ–¼æ˜¯æˆ‘ç¶²è·¯ä¸Šæ‰¾äº†ä¸€ä¸‹è³‡æºï¼Œå¦‚ä¸‹æ‰€ç¤º&lt;br>
&lt;img src="../../images/laravel-magic/eloquent-or-query-builder/speed.jpeg"
loading="lazy"
>&lt;br>
(åœ–ç‰‡è³‡æ–™åƒè€ƒæ–¼ &lt;a class="link" href="https://dev.to/hesamzakerirad/laravel-orm-vs-query-builder-vs-sql-speed-test-4knf" target="_blank" rel="noopener"
>é é¢&lt;/a>)&lt;/p>
&lt;p>&lt;code>Query Builder&lt;/code> èª¿ç”¨çš„é€Ÿåº¦ä¸Šæ¯” &lt;code>Eloquent&lt;/code> é‚„è¦å¿«å¾ˆå¤š (å°‡è¿‘ä¸€å€)&lt;br>
é€™æ¨£ä½ èªª &lt;code>Query Builder&lt;/code> æ¯”è¼ƒå¿«ï¼ŒåŸ·è¡Œä¸Šèªæ³•ä¹Ÿå·®ç•°ä¸å¤§ï¼Œç‚ºä½•é‚„è¦é¸æ“‡ä½¿ç”¨ &lt;code>Eloquent&lt;/code> å‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="eloquent-å„ªå‹¢åœ¨å“ªè£¡">Eloquent å„ªå‹¢åœ¨å“ªè£¡ï¼Ÿ&lt;/h3>
&lt;ol>
&lt;li>å¢åŠ ç¨‹å¼ç¢¼é–±è®€&lt;/li>
&lt;li>relationship é—œè¯å…¶ä»– Model&lt;/li>
&lt;li>Accessors&lt;/li>
&lt;li>Soft Deletes&lt;/li>
&lt;li>Scopes&lt;/li>
&lt;li>Mutators &amp;amp; Casting
&amp;hellip;&amp;hellip; ç­‰ç­‰åŠŸèƒ½&lt;/li>
&lt;/ol>
&lt;p>é›–ç„¶ &lt;code>Eloquent&lt;/code> çš„æ•ˆèƒ½æ¯”è¼ƒä¸å¥½ï¼Œä½†å› è‘—é€™äº›å¼·å¤§åŠŸèƒ½è¦ºå¾—ä¹Ÿæ˜¯ç¨®å–æ¨&lt;/p>
&lt;h2 id="çµè«–">çµè«–&lt;/h2>
&lt;p>æˆ‘å¤§éƒ¨åˆ†çš„åŠŸèƒ½éƒ½æœƒä½¿ç”¨ &lt;code>Eloquent&lt;/code> èˆ‡ &lt;code>Collection&lt;/code> é”æˆä¸€å€‹çµ„åˆæŠ€ï¼Œè¦åŠƒä¸¦å®Œæˆï¼Œ&lt;br>
ä¸éè‹¥æ˜¯ä¸€æ¬¡æ€§æˆ–ä¸å¤ªæœƒç•°å‹•çš„åŠŸèƒ½ï¼Œæ„Ÿè¦ºå°±å¯ä»¥è€ƒæ…®çœ‹çœ‹ &lt;code>Query Builder&lt;/code>ï¼Œ&lt;br>
é›–ç„¶æˆ‘é‚„æ˜¯éƒ½ä½¿ç”¨ &lt;code>Eloquent&lt;/code> ç•¢ç«Ÿé‡åˆ°å¾ŒçºŒçš„éœ€æ±‚ä¿®æ”¹ï¼Œæœƒç›¸å°æå‡å¯å¡‘æ€§(å¥½è®€ã€å¥½æ”¹)&lt;/p></description></item><item><title>Laravel Eloquent è‡ªå®šç¾©è³‡æ–™è¡¨åç¨±(TableName)</title><link>https://www.chihyu.me/2022/08/laravel-magic-eloquent-eloquent-customize-table-name/</link><pubDate>Thu, 04 Aug 2022 02:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/08/laravel-magic-eloquent-eloquent-customize-table-name/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner-eloquent-customize-table-name.png" alt="Featured image of post Laravel Eloquent è‡ªå®šç¾©è³‡æ–™è¡¨åç¨±(TableName)" />&lt;h3 id="intro">intro&lt;/h3>
&lt;p>å¯åƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/9.x/eloquent#table-names" title="eloquent customize table name documentaion"
target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>&lt;/p>
&lt;h3 id="main">main&lt;/h3>
&lt;p>Laravel é è¨­çš„è³‡æ–™è¡¨åç¨±(TableName)éƒ½æ˜¯ Model åç¨±çš„è¤‡æ•¸ï¼Œ&lt;/p>
&lt;p>æˆ‘ç¿’æ…£å»ºç«‹ &lt;code>make:model&lt;/code> æ™‚åŠ ä¸Š &lt;code>-m&lt;/code>ï¼Œ&lt;br>
é€™æ¨£å»ºç«‹ modelæ™‚ï¼Œä¹Ÿå»ºç«‹ migration, è³‡æ–™è¡¨åç¨±(TableName) ä¹Ÿæœƒå¹«æˆ‘è¨­å®šå¥½,&lt;br>
EX:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">php artisan make:model Member -m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†å¦‚æœæˆ‘éœ€è¦ç¨ç«‹é–‹çš„è©±ï¼Œæˆ–tableä¸æ˜¯ä¾†è‡ªmigrationï¼Œ&lt;br>
æˆ‘å¯ä»¥å»ºç«‹ä¸€å€‹ Model,&lt;br>
ä¸¦ç›´æ¥å®šç¾©ä»–è¦ä½¿ç”¨çš„ Tableï¼Œ&lt;br>
å¦‚æ­¤ä¸€ä¾†ï¼Œ&lt;br>
é€™å€‹Tableå°±å¯ä»¥ä½¿ç”¨ Eloquent çš„å¼·å¤§åŠŸèƒ½ ï¼&lt;/p>
&lt;h3 id="ç¯„ä¾‹">ç¯„ä¾‹&lt;/h3>
&lt;p>æª”æ¡ˆ: app\Models\Member.php&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Member&lt;/span> &lt;span class="k">extends&lt;/span> &lt;span class="nx">Model&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">protected&lt;/span> &lt;span class="nv">$table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;member_list&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Laravel ç”¨æˆ¶è§’è‰²/æ¬Šé™è¼•é¬†è¨­å®šçš„å¥—ä»¶</title><link>https://www.chihyu.me/2022/07/laravel-magic-packages-spatie-laravel-permission/</link><pubDate>Sat, 30 Jul 2022 00:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/07/laravel-magic-packages-spatie-laravel-permission/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner-packages-spatie-laravel-permission.png" alt="Featured image of post Laravel ç”¨æˆ¶è§’è‰²/æ¬Šé™è¼•é¬†è¨­å®šçš„å¥—ä»¶" />&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;h3 id="æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬">æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬&lt;/h3>
&lt;p>Laravel: 7&lt;br>
php: 7.3&lt;br>
spatie/laravel-permission: 3&lt;/p>
&lt;p>å¯å…ˆåƒè€ƒ &lt;a class="link" href="https://spatie.be/docs/laravel-permission/v3/introduction" title="documentation"
target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>&lt;/p>
&lt;h3 id="ä»‹ç´¹">ä»‹ç´¹&lt;/h3>
&lt;p>æ¯å€‹ç¶²ç«™é–‹ç™¼å¾€å¾€éƒ½éœ€è¦ä½¿ç”¨è€…çš„æ¬Šé™è¨­å®š&lt;br>
é€™äº›åŠŸèƒ½å…¶å¯¦å°±é‚£äº› ~&lt;/p>
&lt;ul>
&lt;li>å“ªäº›è§’è‰²å¯ä»¥ä½¿ç”¨?&lt;/li>
&lt;li>å“ªäº›æ¬Šé™å¯ä»¥ä½¿ç”¨?&lt;/li>
&lt;/ul>
&lt;p>spatie/laravel-permission ä¸»è¦å°±æ˜¯è¦è§£æ±ºé€™å€‹å•é¡Œ
æ¯å€‹ä½¿ç”¨è€…å¯ä»¥è¨­å®šå¤šè§’è‰²/å¤šæ¬Šé™ ç›¸ç•¶æ–¹ä¾¿&lt;/p>
&lt;h2 id="å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹&lt;/h2>
&lt;h3 id="å®‰è£åŠåˆå§‹åŒ–">å®‰è£åŠåˆå§‹åŒ–&lt;/h3>
&lt;ul>
&lt;li>åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œå®‰è£&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">composer require spatie/laravel-permission
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>é–‹å•Ÿå°ˆæ¡ˆæª”æ¡ˆ &lt;code>config/app.php&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;providers&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">Spatie\Permission\PermissionServiceProvider&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>èˆ‡çµ‚ç«¯æ©ŸåŸ·è¡Œï¼Œå¼•å…¥å¥—ä»¶çš„æª”æ¡ˆ
è£¡é¢å«æœ‰ migrationã€configæª”(&lt;code>config/permission.php&lt;/code>)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">php artisan vendor:publish --provider&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Spatie\Permission\PermissionServiceProvider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å†æ–¼çµ‚ç«¯æ©ŸåŸ·è¡Œï¼Œå»ºç«‹è³‡æ–™è¡¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">php artisan migrate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åœ¨éœ€è¦ä½¿ç”¨æ¬Šé™çš„Model å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Illuminate\Foundation\Auth\User&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nx">Authenticatable&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Spatie\Permission\Traits\HasRoles&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ------ åŠ é€™å€‹ Use Class**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">User&lt;/span> &lt;span class="k">extends&lt;/span> &lt;span class="nx">Authenticatable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">use&lt;/span> &lt;span class="nx">HasRoles&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// ------ åŠ é€™å€‹**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å»ºç«‹è§’è‰²åŠæ¬Šé™">å»ºç«‹è§’è‰²åŠæ¬Šé™&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Spatie\Permission\Models\Role&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">use&lt;/span> &lt;span class="nx">Spatie\Permission\Models\Permission&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$role&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Role&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;writer&amp;#39;&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$permission&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Permission&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;edit articles&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å°‡è§’è‰²è¨­å®šæŸäº›æ¬Šé™">å°‡è§’è‰²è¨­å®šæŸäº›æ¬Šé™&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$role&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Role&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$role&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">permissions&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">sync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$permissions_id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="çµ¦ä½¿ç”¨è€…è§’è‰²èˆ‡æ¬Šé™">çµ¦ä½¿ç”¨è€…è§’è‰²èˆ‡æ¬Šé™&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// çµ¦è§’è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$role&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Role&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$role_id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">assignRole&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$role&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// çµ¦æ¬Šé™
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$permission&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Permission&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$permission_id&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">givePermissionTo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$permission&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å–å¾—ä½¿ç”¨è€…è§’è‰²æˆ–æ¬Šé™">å–å¾—ä½¿ç”¨è€…è§’è‰²æˆ–æ¬Šé™&lt;/h3>
&lt;ul>
&lt;li>å–å¾—ä½¿ç”¨è€…è§’è‰²&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">User&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$roles&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">roles&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å–å¾—ä½¿ç”¨è€…æ¬Šé™&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">User&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ–¹æ³•ä¸€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">getPermissionsViaRoles&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ–¹æ³•äºŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">getAllPermissions&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å…¶ä»–">å…¶ä»–&lt;/h3>
&lt;p>æ›´å¤šè³‡è¨Šå¯ä»¥åƒé–±ä»–å€‘å®˜æ–¹çš„æ–‡ä»¶&lt;br>
å¯å…ˆåƒè€ƒ &lt;a class="link" href="https://spatie.be/docs/laravel-permission/v3/basic-usage/basic-usage" title="basic usage"
target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>&lt;/p>
&lt;h2 id="çµèª">çµèª&lt;/h2>
&lt;p>é€™å€‹å¥—ä»¶çœŸçš„æ»¿å¥½ç”¨çš„&lt;br>
ä¸”ä½¿ç”¨è€…ä¹Ÿå¤šï¼Œè¬ä¸€é‡åˆ°å•é¡Œ Stackoverflow ä¹Ÿå¾ˆå¤šè§£æ³•&lt;br>
çœŸå¿ƒæ¨è–¦çµ¦å¤§å®¶ ğŸ˜„&lt;/p></description></item><item><title>Laravel å–å¾—å€é–“çš„SQL</title><link>https://www.chihyu.me/2022/07/laravel-magic-db-query-log/</link><pubDate>Sat, 16 Jul 2022 02:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/07/laravel-magic-db-query-log/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner-db-query-log.png" alt="Featured image of post Laravel å–å¾—å€é–“çš„SQL" />&lt;h3 id="main">main&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">\DB&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">enableQueryLog&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// Enable query log
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ... query ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">\DB&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">getQueryLog&lt;/span>&lt;span class="p">());&lt;/span> &lt;span class="c1">// Show results of log
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="example">example&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">\DB&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">enableQueryLog&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// Enable query log
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nv">$product&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Product&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">\DB&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">getQueryLog&lt;/span>&lt;span class="p">());&lt;/span> &lt;span class="c1">// Show results of log
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="../../images/laravel-magic/query-log-example-01.jpeg"
loading="lazy"
>&lt;/p></description></item><item><title>Laravel Eloquent è‡ªå®šç¾©ä¸»éµ(primary-key)</title><link>https://www.chihyu.me/2022/07/laravel-magic-eloquent-customize-primary-key/</link><pubDate>Sun, 10 Jul 2022 02:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/07/laravel-magic-eloquent-customize-primary-key/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner-eloquent-customize-primary-key.png" alt="Featured image of post Laravel Eloquent è‡ªå®šç¾©ä¸»éµ(primary-key)" />&lt;h3 id="intro">intro&lt;/h3>
&lt;p>å¯åƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/9.x/eloquent#primary-keys" title="eloquent customize primary key documentaion"
target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>&lt;/p>
&lt;h3 id="main">main&lt;/h3>
&lt;p>Laravel é è¨­çš„ pKey æ˜¯ &lt;code>id&lt;/code>&lt;br>
åœ¨ Model è£¡åŠ å…¥ &lt;code>$primaryKey&lt;/code> åƒæ•¸ï¼Œå°±å¯ä»¥ä½¿ç”¨é€™å€‹è‡ªå®šç¾© pKeyï¼Œ&lt;br>
å¦‚æ­¤ä¸€ä¾†å¾ŒçºŒçš„é—œè¯å°±ä¸ç”¨æ¯æ¬¡éƒ½å®šç¾©é—œè¯çš„ key&lt;/p>
&lt;p>æª”æ¡ˆ: app\Models\Product.php&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Product&lt;/span> &lt;span class="k">extends&lt;/span> &lt;span class="nx">Model&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">protected&lt;/span> &lt;span class="nv">$primaryKey&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;product_id&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Laravel å¤§é‡å¯«å…¥çš„å¥½å¹«æ‰‹ chunk</title><link>https://www.chihyu.me/2022/06/laravel-magic-chunk/</link><pubDate>Sat, 25 Jun 2022 02:00:00 +0800</pubDate><guid>https://www.chihyu.me/2022/06/laravel-magic-chunk/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner-chunk.png" alt="Featured image of post Laravel å¤§é‡å¯«å…¥çš„å¥½å¹«æ‰‹ chunk" />&lt;h2 id="what-is-chunk">What is chunk&lt;/h2>
&lt;p>&lt;img src="../../images/laravel-magic/chunk/what-is-chunk-01.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>å¯ä»¥å°‡ chunk ç†è§£æˆ&amp;hellip;&lt;br>
æˆ‘å°‡ä¸€å¤§çµ„è³‡æ–™åˆ†ã€Œå¡Šã€è™•ç†ï¼Œ&lt;br>
è€Œä¸æ˜¯é€ç­†è™•ç†&lt;/p>
&lt;h2 id="why-chunk">Why chunk&lt;/h2>
&lt;p>å‡è¨­æ¯ç­†å°±è¦åŸ·è¡Œä¸€æ®µSQLï¼Œ&lt;br>
é€™æ¨£æˆ‘ 5000ç­†è³‡æ–™ï¼Œå°±è¦åŸ·è¡Œ 5000æ¬¡&lt;br>
å¦‚æœæˆ‘å°‡é€™ 5000 ç­†ï¼Œæ¯ 500 åˆ†æˆä¸€å¡Šï¼Œæˆ‘åªè¦åŸ·è¡Œ 10 æ¬¡ã€‚&lt;br>
å¦‚æ­¤ä¸€ä¾†å¯ä»¥æœ‰æ•ˆç¸®æ¸›åŸ·è¡Œæ™‚é–“ä¹Ÿé™ä½äº†DBçš„è² æ“”ã€‚&lt;/p>
&lt;h2 id="how-to-chunk">How to chunk&lt;/h2>
&lt;p>&lt;strong>Laravel chunk&lt;/strong> åˆ†æˆä¸‰ç¨®&lt;/p>
&lt;ol>
&lt;li>Query Builder chunk&lt;/li>
&lt;li>Eloquent chunk&lt;/li>
&lt;li>Collection chunk&lt;/li>
&lt;/ol>
&lt;h3 id="å‡è¨­æƒ…å¢ƒ">å‡è¨­æƒ…å¢ƒ&lt;/h3>
&lt;p>ç•¶æˆ‘æœ‰å¥½å¹¾è¬çš„æœƒå“¡ï¼Œæ¯å¹´è¦è´ˆé€ 100é»çš„é»æ•¸çµ¦ä»–å€‘ï¼Œ&lt;br>
æˆ‘å€‘å»ºç«‹äº†ä¸€å€‹æ’ç¨‹ï¼Œæ¯å¹´1æœˆ1æ—¥è´ˆé€ï¼Œ&lt;br>
éš¨è‘—æœƒå“¡æ•¸é‡çš„å¢åŠ ï¼ŒåŸ·è¡Œæ™‚é–“æœƒæ„ˆä¾†æ„ˆä¹…ï¼Œ&lt;br>
æˆ‘å€‘å¿…é ˆè‘—æ‰‹å„ªåŒ–é€™æ®µæ’ç¨‹ &amp;hellip;&lt;/p>
&lt;h3 id="original-no-chunk">Original (No chunk)&lt;/h3>
&lt;p>ç•¶æˆ‘å€‘æ²’æœ‰chunké€šå¸¸éƒ½æ˜¯é€ç­†å¯«å…¥&lt;br>
é€™é‚Šç”¨ &lt;code>each&lt;/code> ä½œç‚ºç¯„ä¾‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">User&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">each&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$user&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Point&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">insert&lt;/span>&lt;span class="p">([&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;amount&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;user_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;created_at&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toDateTimeString&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;updated_at&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toDateTimeString&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="query-builder-chunk">Query Builder chunk&lt;/h3>
&lt;p>å¯åƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/9.x/queries#chunking-results" title="Query Builder chunk documentaion"
target="_blank" rel="noopener"
>æ–‡ä»¶&lt;/a>&lt;/p>
&lt;p>ä½¿ç”¨æ–¹å¼å’Œ &lt;strong>Eloquent chunk&lt;/strong> ç›¸åŒ&lt;br>
æ‰€ä»¥æˆ‘æœƒåœ¨ä¸‹æ–¹ &lt;strong>Eloquent chunk&lt;/strong> å…±åŒè§£é‡‹&lt;/p>
&lt;h3 id="eloquent-chunk">Eloquent chunk&lt;/h3>
&lt;p>å¯åƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/9.x/eloquent#chunking-results" title="Eloquent chunk documentaion"
target="_blank" rel="noopener"
>å®˜æ–¹æ–‡ä»¶&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">User&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">chunk&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$users&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$users&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nv">$user&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$data&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;amount&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;user_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;created_at&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toDateTimeString&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;updated_at&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toDateTimeString&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Point&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é‹ä½œçš„æ–¹å¼æ˜¯ç”¨ SQL ï¼Œ&lt;br>
ä½¿ç”¨ &lt;code>limit 500 offset 0&lt;/code> ã€ &lt;code>limit 500 offset 500&lt;/code> &amp;hellip;.. ç›´åˆ°åˆ†å®Œå…¨éƒ¨&lt;br>
åœ¨ query ç•¶ä¸‹å°±åˆ†å¡Šã€‚&lt;/p>
&lt;h3 id="collection-chunk">Collection chunk&lt;/h3>
&lt;p>å¯åƒè€ƒ &lt;a class="link" href="https://laravel.com/docs/9.x/collections#method-chunk" title="Collection chunk documentaion"
target="_blank" rel="noopener"
>å®˜æ–¹æ–‡ä»¶&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$chunks&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">User&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">query&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">map&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$user&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;amount&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;user_id&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$user&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">id&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;created_at&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toDateTimeString&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;updated_at&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toDateTimeString&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">chunk&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">toArray&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nv">$chunks&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nv">$chunk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Point&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="na">insert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$chunk&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é‹ä½œçš„æ–¹å¼æ˜¯å…ˆéƒ½ queryå‡ºä¾†ï¼Œå†ç”¨ php æ•´ç†çš„ï¼Œ&lt;/p>
&lt;p>å¦‚åœ–æ‰€ç¤º&lt;br>
&lt;img src="../../images/laravel-magic/chunk/collection-chunk-demo.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="æ¯”è¼ƒ">æ¯”è¼ƒ&lt;/h2>
&lt;p>è€å¯¦èªªä½¿ç”¨å“ªä¸€å€‹å…¶å¯¦æ„Ÿè¦ºä¸å‡ºä¾†ï¼Œ&lt;br>
å› ç‚ºåŸ·è¡Œæ•ˆç‡å·®ä¸å¤šï¼Œ&lt;br>
Eloquent åƒDBè³‡æºï¼ŒCollection åƒè¨˜æ†¶é«”è³‡æºï¼Œ&lt;/p>
&lt;p>&lt;strong>Collection chunk&lt;/strong> é‡éç›´æ¥ç¶²é åŸ·è¡Œï¼Œè¨˜æ†¶é«”åƒæ›äº†çš„å•é¡Œï¼Œ&lt;/p>
&lt;p>æœ€å¾Œæˆ‘é‚„æ˜¯é¸æ“‡äº† &lt;strong>Eloquent chunk&lt;/strong>&lt;br>
é›–ç„¶ åŸ·è¡Œçš„SQLå¤šäº†ä¸€äº› queryï¼Œä½†ä¸æœƒåƒä½ è¨˜æ†¶é«”ï¼Œ&lt;/p>
&lt;p>ä¹Ÿæ˜¯çœ‹å¤§å®¶å–æ¨æ‹‰ ~&lt;/p>
&lt;p>é€™æ˜¯æˆ‘åŸ·è¡Œ3åƒç­†çš„è³‡è¨Š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">è³‡æ–™é‡&lt;/th>
&lt;th>é‹ç”¨&lt;/th>
&lt;th style="text-align: right">èŠ±è²»æ™‚é–“&lt;/th>
&lt;th style="text-align: right">è¨˜æ†¶é«”&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">3000ç­†&lt;/td>
&lt;td>Original (No chunk)&lt;/td>
&lt;td style="text-align: right">6.6s&lt;/td>
&lt;td style="text-align: right">142MB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">3000ç­†&lt;/td>
&lt;td>Eloquent chunk&lt;/td>
&lt;td style="text-align: right">1.52s&lt;/td>
&lt;td style="text-align: right">33MB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">3000ç­†&lt;/td>
&lt;td>Collection chunk&lt;/td>
&lt;td style="text-align: right">1.49s&lt;/td>
&lt;td style="text-align: right">141MB&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="é¡Œå¤–è©±">é¡Œå¤–è©±&lt;/h2>
&lt;p>é€™è£¡çš„å¯«å…¥ä½¿ç”¨äº† &lt;code>Point::insert&lt;/code> ç‚ºä½•ä¸ä½¿ç”¨ &lt;code>Point::create&lt;/code> ?&lt;br>
æ˜¯ç‚ºäº†æ‰¹æ¬¡å¯«å…¥åŠæ•ˆç‡çš„å•é¡Œè€ƒé‡ï¼Œ&lt;br>
ä¹‹å¾Œå†ä¾†èŠèŠ Laravel insert &amp;amp; Laravel create å·®ç•°å§&lt;/p></description></item><item><title>Laravel Magic ç³»åˆ— - ç¬¬1ç¯‡</title><link>https://www.chihyu.me/2022/06/laravel-magic-intro/</link><pubDate>Thu, 23 Jun 2022 23:08:15 +0800</pubDate><guid>https://www.chihyu.me/2022/06/laravel-magic-intro/</guid><description>&lt;img src="https://www.chihyu.me/images/laravel-magic/banner.png" alt="Featured image of post Laravel Magic ç³»åˆ— - ç¬¬1ç¯‡" />&lt;p>&lt;strong>Laravel Magic&lt;/strong> ç³»åˆ—ç‚ºæˆ‘ä½¿ç”¨ Laravel çš„æ™‚æ–¹ä¾¿çš„åŠŸèƒ½ã€æ¨èçš„æ’‡å¸ƒç­‰ç­‰ &amp;hellip;&lt;/p>
&lt;p>å¯ä»¥ç•¶ä½œ Laravel çš„é›œè¨˜ ~&lt;/p>
&lt;p>æˆ‘èªç‚º Laravel æä¾›å¾ˆå¤šç¥å¥‡æ–¹æ³•ï¼Œ&lt;br>
ä½¿ç”¨èµ·ä¾†å°±åƒæ˜¯é­”è¡“èˆ¬çš„ç¾å¦™&lt;br>
æ•…ä»¥æ­¤å‘½åã€‚ğŸ‘ğŸ‘ğŸ‘&lt;/p></description></item></channel></rss>